<!DOCTYPE html>

<html>
<head>
  {% block head %}
    <title>{% block title %}{% endblock %} - V3</title>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="../static/charts.js"></script>
  <script type="text/javascript">
  $(function() {
    $('select#project').bind('change', function() {
      $("#repo").empty()
                .prop("disabled", true)
                .append("<option>Loading Repos...</option>");
      $.getJSON($SCRIPT_ROOT + '/_return_repos', {
        key: $("#project").find(":selected").val()
      }, function(data) {
        if (data.result === ""){
          $("#repo").empty()
                    .prop("disabled", true)
                    .append("<option>No Repos Available</option>");
        }
        else {
          $('#repo').prop( "disabled", false )
                    .empty()
                    .append("<option value='' disabled selected>Select a Repo</option>")
                    .append(data.result);
        }
      });
      return false;
    });
  });
  $(function() {
    $('#repo').bind('change', function() {
      $("#spinner").show();
      $.getJSON($SCRIPT_ROOT + '/_return_repo_dates', {
        key: $("#project").find(":selected").val(),
        name: $("#repo").find(":selected").text()
      }, function(data) {
        if (data.result === ""){
          //TODO error handling
          console.log("boo")
        }
        else {
          $("#previousDate").val(data.result[data.result.length-1].split(' ')[0])
              .prop("disabled",false);
          $("#currentDate").val(data.result[0].split(' ')[0])
              .prop("disabled",false);
          $("#nextbutton").prop("disabled",false);
          $("#spinner").hide();
          commitSelector(data.result);
        }
      });
      return false;
    });
  });
</script>
  {% endblock %}
</head>

<body>
  <center><div id="timetag"></div></center>
  <div id="spinner" class="spinner" style="display:none;">
    <img id="img-spinner" src="../static/images/spinner.gif" alt="Loading"/>
  </div>

<form class="form-inline" method="POST" enctype="multipart/form-data">
<center>
<div id="repo-select" class="form-group">
  <label for="project">Select a Project: </label><br>
  <select id="project" name='proj_key' class="form-control">
    <option value="" disabled selected>Select a Project</option>
    {% for project in list_of_projects %}
     <option value="{{project[0]}}">{{project[1]}}</option>
    {% endfor %}
  </select>
  <select id="repo" disabled="true" name='repo_name' class="form-control">
    <option value="" disabled selected>Select a project first</option>
  </select>
</div>
<br>
<div id="date-select" class="form-group">
    <label for="formInput">Enter Start Date (Default First -> Last Commit):</label><br>
    <input type="date" class="form-control" id="previousDate" name="from_date" value="" placeholder='YYYY-MM-DD' disabled="true">
    <label for="formInput"> -> </label>
    <input type="date" class="form-control" id="currentDate" name="to_date" value="" placeholder='YYYY-MM-DD' disabled="true">
    <div id="commitSelector"></div>
</div>
<br>
<div id="submit-form" class="form-group">
    <button type="submit" name="submit_button" value="run_analysis" id="nextbutton" class="btn btn-lg btn-primary" role="button" disabled="true">
      Run analysis
    </button>
</div>
</center>

</form>

<!-- <button onclick="test_name()">Check name</button> -->

<!-- modal for viewing repository details
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Repository Details</h4>
      </div>
      <div class="modal-body">
        {# not used yet
        {% for repo in repo_list %}
          {% if repo == project_name %}
              {{project_description}}
          {% endif %}
        {% endfor %}
          #}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div> -->

<script>

function displayTime(elem) {
  var timetag = elem.children[0].value.split('|');
  if (timetag[1] != undefined) {
    $("#timetag").text(timetag[0] + ' updated as of: ' + timetag[1]);
    $("#previousDate").val(timetag[2]);
    $("#currentDate").val(timetag[3]);
  }
}

$("#nextbutton").click(function() {
  var $btn = $(this);
  $btn.button('loading');
  $("#spinner").show();
});
</script>
</body>
</html>
