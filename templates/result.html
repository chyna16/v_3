{% extends "layout.html" %}

{% block title %} Result {% endblock %}

{% block head %}
    <link rel=stylesheet type=text/css href="../static/style.css">
    <script src="../static/d3.min.js"></script>
    <script src="../static/table.js"></script>
    <script src="../static/charts.js"></script>
    <script src="../static/interactivity.js"></script>
{% endblock %}

{% block content %}
<div class="help">
    ?
    <p id="help" class="help-drop"></p>
</div>

<h1 style="padding-bottom:0;">Results for: {{ repo_name }}</h1>
<h2 style="padding-top:0;"> 
    From
        {% if from_date != '' %} {{ from_date }}
        {% else %} Beginning 
        {% endif %}
    to
        {% if to_date != '' %} {{ to_date }}
        {% else %} Present 
        {% endif %}
</h2>
    <div class ="tooltipinfo">
        <h2></h2>
        <table>
            <tr id="type">
                <th></th>
                <td></td>
            </tr>
            <tr id="value">
                <th></th>
                <td></td>
            </tr>
        </table>
    </div>
<center>
    <div id="header"></div>
    <div id="wrapper" style="display: block; width: 1000px; overflow-x: auto;"></div>
    <button> Hide labels</button>
</center>

<center>
<form id="filter" style="font-size:15px; width: 300px;">
    <!-- Column: {% for key in keys|fromjson %}
                {% if key != (keys|fromjson)[0] and key != "coupled" %}
                <input type="radio" name="key" value={{ key }}> {{ key }} 
                {% endif %}
            {% endfor %} 
    &nbsp;&nbsp;&nbsp;
    From: <input type="text" name="start" style="width:40px">
    To: <input type="text" name="end" style="width:40px">
    &nbsp;&nbsp;&nbsp;
    <input type="button" value="Filter" onclick="setFilter()">
    <br> -->
    {% for key in keys|fromjson %}
        {% if key != (keys|fromjson)[0] and key != "coupled" %}
        <div id={{key}} class="row" name={{key}} style="float: left; margin: 25px;">
        {{key}}: <br>
        from: <input id="slider" type="range" name="from" min="0" max="10" value="0" style="width: 100px;">
        to: <input id="slider" type="range" name="to" min="0" max="10" value="10" style="width: 100px;">
        </div>
        {% endif %}
    {% endfor %}

    <input type="button" value="Filter" onclick="setFilter()">
</form>
</center>

<br>
<br>

<center>
<div class="col-md-10" style="float:none">
    <table class="table">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
    </table>
</div>
</center>

<script>
    var keys = {{keys|safe}}; // an array of the column headers in original order
    var json_data = {{data|safe}}; // an array of objects for row of data
    var analysis_type = {{analysis|safe}}
    var repo = {{repo_name|safe}}

    // default filter variables
    // declared outside so that value can be changed/accessed by other functions
    var filtered_data = json_data; // to be used as a filtered copy of json_data
    var filter_obj = [];

    // sets the min and max values of sliders appropriately
    function adjustSlider() {
        keys.forEach(function(key) {
            if (key != keys[0] && key != 'coupled') {
                var max = d3.max(json_data, function(d) { return +d[key]; })
                var slider = document.getElementById(key);
                slider.children[1].max = max;
                slider.children[2].max = max;
                slider.children[2].value = max;
            }
        });
    }

    var chosen_key = "default"; // the default key represents all columns
    if (analysis_type == 'metrics') { chosen_key = 'n-revs'; }
        // if the analysis is metrics, then revs column should be default

    var help = document.getElementById("help");
    var help_desc = {
        "metrics": "View raw data for each module. Select a column to use for filtering, and enter the range (blank equals min / max respectively). Click on a column header to see data only for that column. Place your mouse over a bar to see exact value.",
        "age": "Compare lines added vs lines deleted. Select a column to use for filtering, and enter the range (blank equals min / max respectively). Click on a column header to see data only for that column. Place your mouse over a bar to see exact value.",
        "hotspots": "Hotspots indicate which modules you may need to take a closer look at. The size of the module is determined by complexity (n-lines) and the shade of red determined by effort (n-revs), proportional to the repository. Look out for the big and bright red ones. These are the ones which may need refactoring. Select a column to use for filtering, and enter the range (blank equals min / max respectively). Place your mouse over the bubbles to see module name.",
        "coupling": "Coupling shows relational data between modules based on how often they were committed together. Click on a module name to see what other modules it is coupled with and to what extent. Degree shows percentage of times that module was committed with the selected entity. Paired modules with high degree of coupling implies dependency; if one is changed, the other is likely to be affected.",
        "cloud": "View the patterns within commit messages. See which words are used the most while committing to get an understanding of things that are commonly worked on. The size of the word is proportional to frequency."
    };
    help.innerHTML = help_desc[analysis_type]; // text that will appear when ? is hovered

    // the script waits until all the html content has been loaded
    // before calling the function
    // to create the default table/graph
    document.addEventListener("DOMContentLoaded", function(event) {
        createTable(json_data);
        adjustSlider();
    })

</script>
{% endblock %}
